"use strict";!function r(s,a,c){function u(t,e){if(!a[t]){if(!s[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(d)return d(t,!0);var o=new Error("Cannot find module '"+t+"'");throw o.code="MODULE_NOT_FOUND",o}var i=a[t]={exports:{}};s[t][0].call(i.exports,function(e){return u(s[t][1][e]||e)},i,i.exports,r,s,a,c)}return a[t].exports}for(var d="function"==typeof require&&require,e=0;e<c.length;e++)u(c[e]);return u}({1:[function(e,t,n){var s;s=e("./audioBuffer")(),t.exports=function(e){var o,i,r,l,f,p=0;return{beginAnalyse:function(e,t,n){n=n||function(){};try{o=function(){if(window.AudioContext||window.webkitAudioContext)return new AudioContext;throw new Error("audio context unavailable within this browser...")}()}catch(e){return void console.log(e.toString())}i=o.createMediaStreamSource(e),r=i.context.createScriptProcessor(4096,1,1),(l=i.context.createAnalyser()).minDecibels=-90,l.maxDecibels=-10,l.smoothingTimeConstant=.85,i.connect(l),l.connect(r),r.connect(i.context.destination),console.log("source.context.sampleRate= "+i.context.sampleRate),s.initSampleRate(i.context.sampleRate),console.log("analyse audio..."),r.addEventListener("audioprocess",function(e){console.log("process"),console.info("processing audio..."),s.whileRecording(e.inputBuffer.getChannelData(0)),function(e,t,n){l.fftSize=2048;var o=l.fftSize,i=new Uint8Array(o),r=e.amplitude,s=e.time;l.getByteTimeDomainData(i);for(var a=0;a<o;a++){var c=i[a]/128-1;(r<c||c<-1*r)&&(f=Date.now())}var u=Date.now();0===p&&(f=u);var d=u-f;if(console.log("elapsed time: "+d),console.log("time: "+s),console.log(p),s<d)return t(!(p=0),n);p++}(t,n,e.playbackTime)})},stopAnalysing:function(){l.disconnect(),r.disconnect()},resumeAnalysing:function(){p=0,l.connect(r),r.connect(i.context.destination)}}}},{"./audioBuffer":2}],2:[function(e,t,n){var l,d=[],f=0;t.exports=function(e){function a(e,t,n){for(var o=0;o<n.length;o++)e.setUint8(t+o,n.charCodeAt(o))}function c(e,t){console.log("bbb length: "+t);for(var n=new Float32Array(t),o=0,i=0;i<e.length;i++)n.set(e[i],o),o+=e[i].length;return n}function u(e,t){if(t===l)return e;for(var n=l/t,o=Math.round(e.length/n),i=new Float32Array(o),r=0,s=0;r<i.length;){for(var a=Math.round((r+1)*n),c=0,u=0,d=s;d<a&&d<e.length;d++)c+=e[d],u++;i[r]=c/u,r++,s=a}return console.log("res: "+i),i}return e=e||{},{whileRecording:function(e){d.push(e),f+=e.length},initSampleRate:function(e){l=e},exportBufferAsBlob:function(e){var t=c(d,f);console.log("merged buffers: "+c);var n=u(t,e);console.log(u);var o,i,r,s=(o=n,i=new ArrayBuffer(44+2*o.length),a(r=new DataView(i),0,"RIFF"),r.setUint32(4,32+2*o.length,!0),a(r,8,"WAVE"),a(r,12,"fmt "),r.setUint32(16,16,!0),r.setUint16(20,1,!0),r.setUint16(22,1,!0),r.setUint32(24,l,!0),r.setUint32(28,2*l,!0),r.setUint16(32,2,!0),r.setUint16(34,16,!0),a(r,36,"data"),r.setUint32(40,2*o.length,!0),function(e,t,n){for(var o=0;o<n.length;o++,t+=2){var i=Math.max(-1,Math.min(1,n[o]));e.setInt16(t,i<0?32768*i:32767*i,!0)}}(r,44,o),r);return new Blob([s],{type:"application/octet-stream"})}}}},{}],3:[function(e,t,n){n.checkMediaDevice=function(){return new Promise(function(t,n){navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia({audio:!0}).then(function(e){t(e)}).catch(function(e){console.info("error get user media: "+e),n("err: "+e)}):n("no existing media device in this browser")})}},{}],4:[function(t,n,e){(function(e){e.FastRecorder=e.FastRecorder||{},e.FastRecorder.audioRecorder=t("./recorder"),n.exports=e.FastRecorder}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./recorder":5}],5:[function(e,t,n){var a=e("./helpers"),c=e("./analyser")(),o=e("./audioBuffer")(),r=e("./sampleAudio")();function i(e){e={};this.context=new AudioContext,this.Chunks=[],this.Blob=e.blob||null,this.Url=e.Url||null,this.Audio=e.Audio||null,this.AudioLength=0,this.mediaRecorder=null,this.recordStopped=!1,this.elapsedTime=0,this.isPaused=!1,this.test="test prototype",this.silenceDetectionTime=3e3,this.silenceDetectionAmplitude=.2,this.reSampleRate=16e3,this.speechSynthesisCounter=0,this.speechSynthesisCounterPrevious=0,i.speechSynthesisInstances++}i.speechSynthesisInstances=0,i.prototype.getCount=function(){return i.speechSynthesisInstances},i.prototype.configureSilence=function(e){e=e||{},this.silenceDetectionTime=e.hasOwnProperty("time")?e.time:this.silenceDetectionTime,this.silenceDetectionAmplitude=e.hasOwnProperty("amplitude")?e.amplitude:this.silenceDetectionAmplitude},i.prototype.startRecording=function(o,i,r){var s=this;console.log(this.test),a.checkMediaDevice().then(function(t){console.log(t),s.mediaRecorder=new MediaRecorder(t),s.mediaRecorder.start(),console.log(JSON.stringify(s.mediaRecorder)),s.mediaRecorder.addEventListener("start",function(e){console.info("beginning recording..."),"function"==typeof o&&o(),c.beginAnalyse(t,{time:s.silenceDetectionTime,amplitude:s.silenceDetectionAmplitude},function(e,t){e&&"function"==typeof i&&(t=parseFloat(t.toFixed(2)),i(t))})}),s.mediaRecorder.addEventListener("dataavailable",function(e){console.log(JSON.stringify(e)),console.log(e.data),s.Chunks.push(e.data),console.info("recorder collecting data..."),s.elapsedTime=s.elapsedTime+100,s.AudioLength=s.elapsedTime,r((s.elapsedTime/1e3).toFixed(2))});var n=setInterval(function(){try{if(!s.isPaused)s.mediaRecorder.requestData()}catch(e){clearInterval(n)}},100)}).catch(function(){console.error(err)})},i.prototype.stopRecording=function(e){console.log(this.test);var t=this;t.mediaRecorder?(t.mediaRecorder.stop(),t.mediaRecorder.addEventListener("stop",function(){if(c.stopAnalysing(),t.mediaRecorder=null,t.Blob=new Blob(t.Chunks,{type:"audio/x-l16"}),t.Url=URL.createObjectURL(t.Blob),t.AudioLength=0,t.elapsedTime=0,console.info("recorder stopped"),e&&"function"==typeof e)return e(null,t.Blob,t.Url),void(t.Chunks=[]);t.Chunks=[]})):e("media recorder isn't started yet or it is already stopped")},i.prototype.restart=function(e,t,n){var o=this;this.mediaRecorder?this.stopRecording(function(){o.startRecording(e,t,n)}):e("no recording started yet")},i.prototype.isSilentAudio=function(e,n){var t=this;t.Audio=new Audio(t.Url),console.log(t.Audio),t.Audio.play(),console.log(t.Audio.duration),t.Audio.addEventListener("play",function(){console.log("paly play");var e=t.Audio.captureStream();c.beginAnalyse(e,{time:5e3,amplitude:t.silenceDetectionAmplitude},function(e,t){e&&"function"==typeof n&&n(t)})})},i.prototype.exportAsBlob=function(){return o.exportBufferAsBlob(16e3)},i.prototype.exportResampledAudio=function(n,o){var i=this;if(i.mediaRecorder)o("recording isn't stopped yet");else{var e=new FileReader;e.addEventListener("load",function(){console.log("loading..."),i.context.decodeAudioData(e.result,function(e){var t=n&&"number"==typeof n&&1e4<=n&&n<=2e4?n:i.reSampleRate;r.reSampleBuffer(e,t,function(e){var t=r.convertFloat32ToInt16(e.getChannelData(0));if("function"!=typeof o)throw new Error("type provided as a callback is not a function");o(null,t)})})}),e.readAsArrayBuffer(i.Blob)}},i.prototype.exportAsMP3=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"test";return this.Blob?new File([this.Blob],e+".mp3",{type:"audio/mpeg"}):null},i.prototype.pause=function(e){var t=this;t.mediaRecorder&&!1===t.isPaused?(t.mediaRecorder.pause(),t.mediaRecorder.addEventListener("pause",function(){if(t.Blob=new Blob(t.Chunks),t.Url=URL.createObjectURL(t.Blob),t.isPaused=!0,c.stopAnalysing(),"function"!=typeof e)throw new Error("callback isn't a function");e(null,t.Url,t.elapsedTime)})):!0===t.isPaused?e("media recorder is already paused"):e("media recorder isn't started yet")},i.prototype.resume=function(e){var t=this;t.mediaRecorder&&!0===t.isPaused?(t.mediaRecorder.resume(),t.mediaRecorder.addEventListener("resume",function(){if(t.isPaused=!1,c.resumeAnalysing(),"function"!=typeof e)throw new Error("callback isn't a function");e(null,"resumed")})):!1===t.isPaused?e("media recorder isn't paused"):e("media recorder isn't started yet")},i.prototype.playAudio=function(e){var t=this;return e?(t.Audio=new Audio(e),void t.Audio.play()):t.Url?(t.Audio=new Audio(t.Url),void t.Audio.play()):t.Blob?(t.Audio=new Audio(t.Blob),void t.Audio.play()):void console.info("audio isn't ready yet")},i.prototype.speakText=function(t,n,o){var i=this;if(!t.text||void 0===t.text)throw new Error("no text provided");if(!window||!window.speechSynthesis)throw new Error("not supported here");var r=window.speechSynthesis,s=new SpeechSynthesisUtterance(t.text);s.volume=1,s.lang="en-US",s.pitch=t.pitch&&0<=t.pitch&&t.pitch<=10?t.pitch:1,s.rate=t.rate&&0<=t.rate&&t.rate<=2?t.rate:1.2,void 0!==speechSynthesis.onvoiceschanged?(r.onvoiceschanged=function(){window.speechSynthesisInstances?i.speechSynthesisCounterPrevious===i.speechSynthesisCounter&&window.speechSynthesisInstances++:window.speechSynthesisInstances=1,i.speechSynthesisCounterPrevious=i.speechSynthesisCounter++;var e=r.getVoices&&"function"==typeof r.getVoices?r.getVoices():[];s.voice=t.voice&&"woman"===t.voice?e.filter(function(e){return"Samantha"===e.name})[0]:e.filter(function(e){return"Alex"===e.name})[0],r.speak(s)},(0<i.speechSynthesisCounter||0<window.speechSynthesisInstances)&&r.dispatchEvent(new Event("voiceschanged"))):r.speak(s),s.addEventListener("start",function(e){console.log("speech has started"),"function"==typeof n&&n()}),s.addEventListener("end",function(e){console.log("end speaking..."),r.cancel(),"function"==typeof o&&o()})},t.exports=i},{"./analyser":1,"./audioBuffer":2,"./helpers":3,"./sampleAudio":6}],6:[function(e,t,n){t.exports=function(e){return{reSampleBuffer:function(e,t,n){var o=e.numberOfChannels,i=e.length*t/e.sampleRate,r=new OfflineAudioContext(o,i,t),s=r.createBufferSource();s.buffer=e,s.connect(r.destination),s.start(0),r.startRendering().then(function(e){n(e)})},convertFloat32ToInt16:function(e){var t=e.length;console.log("buffer length: "+t);for(var n=new Int16Array(t);t--;)n[t]=32767*Math.min(1,e[t]);return n.buffer}}}},{}]},{},[4]);